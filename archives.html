<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <!-- =========================
         Head Section: Meta, Fonts, CSS
         ========================= -->
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Archives</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="style.css"/>
</head>
<body class="overflow-x-hidden" x-data="mediaViewer()" x-init="init()">
    <!-- =========================
         Background Grid & Scanline Overlay
         ========================= -->
    <div class="scanline-overlay"></div>
    <div class="vignette-overlay"></div>
    <div class="fixed inset-0 border-2 border-[var(--border-color)] m-4 pointer-events-none"></div>

    <!-- =========================
         Decorative Decals
         ========================= -->
    <div class="decal top-[15%] left-[10%]">[DECAL_ID:A7B3]</div>
    <div class="decal top-[60%] right-[12%] rotate-90">[DECAL_ID:C9D2]</div>
    <div class="decal bottom-[10%] left-[20%]">[DECAL_ID:F4E1]</div>

    <!-- =========================
         Main Container
         ========================= -->
    <div class="relative flex min-h-screen w-full flex-col p-4 sm:p-6 lg:p-8">
        <!-- =========================
             Header & Navigation
             ========================= -->
        <header class="fixed top-0 left-0 right-0 z-50 p-4">
            <div class="mx-auto flex max-w-7xl items-center justify-between px-4">
                <a class="navbar-logo text-2xl font-bold tracking-widest" href="http://carbon.faith">
                    carbon.faith
                </a>
                <nav class="hidden md:flex items-center space-x-8">
                    <a class="nav-link text-lg" href="archives.html">Archives</a>
                    <a class="nav-link text-lg" href="esotecha.html">Esotecha</a>
                    <a class="nav-link text-lg" href="meta.html">Meta</a>
                </nav>
                <button aria-label="Open menu" class="md:hidden text-2xl nav-link">
                    [menu]
                </button>
            </div>
        </header>

        <!-- =========================
             Main Content & Centerpiece
             ========================= -->
        <main class="flex flex-1 flex-col items-center justify-center pt-16 pb-8">
            <div class="w-full max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- File List -->
                <section class="md:col-span-1 flex flex-col">
                    <div class="border-2 border-[var(--primary-color)] p-6 bg-[var(--background-dark)]/80">
                        <h2 class="text-lg font-bold text-[var(--primary-color)] mb-4">// MEDIA_FILES</h2>
                        <ul class="flex-grow space-y-2 overflow-y-auto scrollbar pr-2">
                            <template :key="index" x-for="(file, index) in files">
                                <li>
                                    <button :class="{
                                        'bg-[var(--primary-color)]/20': activeFileIndex === index,
                                        'hover:bg-[var(--primary-color)]/10': activeFileIndex !== index
                                    }"
                                    @click="selectFile(index)"
                                    class="w-full text-left p-2 transition-colors flex items-center rounded">
                                        <span class="material-icons text-[var(--primary-color)] mr-2 text-base" x-text="file.type === 'text' ? 'transcript' : 'codec'"></span>
                                        <span x-text="file.name"></span>
                                    </button>
                                </li>
                            </template>
                        </ul>
                    </div>
                </section>
                <!-- Viewport -->
                <section class="md:col-span-3 flex flex-col">
                    <div class="border-2 border-[var(--primary-color)] p-6 bg-[var(--background-dark)]/80 flex-grow flex flex-col">
                        <h2 class="text-lg font-bold text-[var(--primary-color)] mb-4" x-text="`// VIEWPORT [${files[activeFileIndex].name}]`"></h2>
                        <div class="flex-grow bg-black border border-[var(--border-color)] overflow-y-auto overflow-x-hidden rounded scrollbar">
                            <template x-if="files[activeFileIndex].type === 'text'">
                                <div class="p-4">
                                    <div class="prose prose-sm max-w-none text-[var(--text-color)] prose-headings:text-[var(--primary-color)]"
                                         x-html="files[activeFileIndex].content"></div>
                                </div>
                            </template>
                            <template x-if="files[activeFileIndex].type === 'video'">
                                <div class="w-full h-full bg-black flex items-center justify-center">
                                    <video :src="files[activeFileIndex].content" autoplay class="max-w-full max-h-full" controls muted>
                                        Your browser does not support the video tag.
                                    </video>
                                </div>
                            </template>
                            <template x-if="files[activeFileIndex].type === 'youtube'">
                                <div class="w-full h-full flex items-center justify-center bg-black">
                                    <iframe
                                        :src="files[activeFileIndex].content"
                                        frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        allowfullscreen
                                        class="w-full h-[60vh] max-w-full rounded"
                                    ></iframe>
                                </div>
                            </template>
                            <template x-if="files[activeFileIndex].type === 'gdrive'">
                                <iframe class="w-full h-64"
                                        :src="files[activeFileIndex].content"
                                        frameborder="0"
                                        allow="autoplay">
                                </iframe>
                            </template>
                        </div>
                    </div>
                </section>
            </div>
        </main>
        <!-- Footer -->
        <footer class="text-center text-xs text-[var(--primary-color)]/40 py-6 mt-auto relative">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-1/3 h-px bg-gradient-to-r from-transparent via-[var(--primary-color)]/30 to-transparent"></div>
            <p>INITIATED 2023 // TRIBOLUMIN_PROTOCOLS // ALL RIGHTS RESERVED_</p>
        </footer>
    </div>

    <!-- Alpine.js & Viewer Script -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        function mediaViewer() {
            const txtFiles = [
                'Breath.txt',
                'INFOHAZARD.txt',
                'Liminal.txt',
                'Metamorphic.txt',
                'Ephemeris.txt'
            ];
            return {
                activeFileIndex: 0,
                files: [
                    {
                        name:'welcome.txt',
                        type: 'text',
                        content: 'Welcome to the Archives. Select a file from the list to view its content here.'
                    },
                    ...txtFiles.map(name => ({
                        name: name.replace('.txt', ''),
                        type: 'text',
                        content: `<div style="white-space: pre-wrap; word-break: break-word;">Loading...</div>`
                    })),
                    {
                        name:'Breath.mp4',
                        type: 'youtube',
                        content: 'https://www.youtube.com/embed/83jYNWLWg60'
                    },
                    {
                        name: 'point mandala.mp4',
                        type: 'gdrive',
                        content: 'https://drive.google.com/file/d/1k_YsIOYG6AYre1VUyBNP4sRkAgUkvrHw/preview'
                    },
                ],
                selectFile(index) {
                    this.activeFileIndex = index;
                    // Only fetch if it's a text file and not the welcome message
                    if (this.files[index].type === 'text' && index > 0) {
                        this.fetchTxtFile(index - 1);
                    }
                },
                async fetchTxtFile(txtIndex) {
                    const filename = txtFiles[txtIndex];
                    if (!filename) {
                        this.files[this.activeFileIndex].content = `<p>File not found.</p>`;
                        return;
                    }
                    try {
                        const resp = await fetch('data/' + filename);
                        const text = await resp.text();
                        this.files[this.activeFileIndex].content = `<div style="white-space: pre-wrap; word-break: break-word;">${text}</div>`;
                    } catch (e) {
                        this.files[this.activeFileIndex].content = `<p>Failed to load ${filename}</p>`;
                    }
                },
                init() {}
            }
        }
    </script>
</body>
</html>